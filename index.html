
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Chaloupe - Gagnant du pli</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            text-align: center;
        }
        h1 {
            margin-bottom: 20px;
        }
        .joueur {
            margin: 10px 0;
        }
        .cartes {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
        .carte {
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            margin: 5px;
            background: white;
            width: 40px;
            cursor: pointer;
        }
        .carte.disabled {
            background: #ddd;
            cursor: default;
        }
        .pli {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>üÉè La Chaloupe ‚Äì Gagnant du pli</h1>
    <button onclick="distribuerCartes()">Distribuer les cartes</button>
    <p id="tourInfo">Appuie sur "Distribuer les cartes"</p>
    <div id="joueurs"></div>
    <div class="pli">
        <h2>Pli en cours :</h2>
        <div id="pliZone" class="cartes"></div>
        <p id="resultatPli"></p>
    </div>

    <script>
        const couleurs = ["‚ô†Ô∏è", "‚ô•Ô∏è", "‚ô¶Ô∏è", "‚ô£Ô∏è"];
        const ordreValeurs = ["7", "8", "9", "J", "Q", "K", "10", "A"];
        const valeurs = [
            {valeur: "7", points: 0},
            {valeur: "8", points: 0},
            {valeur: "9", points: 0},
            {valeur: "J", points: 1},
            {valeur: "Q", points: 2},
            {valeur: "K", points: 3},
            {valeur: "10", points: 5},
            {valeur: "A", points: 4}
        ];
        const nomsJoueurs = ["Toi", "Ami", "Robot 1", "Robot 2"];
        let joueurs = [];
        let joueurActuel = 0;
        let pli = [];

        function genererDeck() {
            let deck = [];
            for (let c of couleurs) {
                for (let v of valeurs) {
                    deck.push({couleur: c, valeur: v.valeur, points: v.points});
                }
            }
            return deck.sort(() => Math.random() - 0.5);
        }

        function distribuerCartes() {
            let deck = genererDeck();
            joueurs = [];
            pli = [];
            joueurActuel = 0;
            document.getElementById("resultatPli").textContent = "";
            for (let i = 0; i < 4; i++) {
                joueurs.push({
                    nom: nomsJoueurs[i],
                    main: deck.slice(i*8, i*8 + 8)
                });
            }
            afficherJoueurs();
            mettreAJourTour();
            document.getElementById("pliZone").innerHTML = "";
            if (joueurActuel >= 2) setTimeout(robotJoue, 1000);
        }

        function jouerCarte(indexCarte) {
            const joueur = joueurs[joueurActuel];
            const carte = joueur.main.splice(indexCarte, 1)[0];
            pli.push({joueur: joueur.nom, carte: carte});
            joueurActuel = (joueurActuel + 1) % 4;
            afficherJoueurs();
            afficherPli();
            if (pli.length === 4) {
                setTimeout(detecterGagnantPli, 1000);
            } else {
                mettreAJourTour();
                if (joueurActuel >= 2) setTimeout(robotJoue, 1000);
            }
        }

        function robotJoue() {
            if (joueurActuel < 2) return;
            const joueur = joueurs[joueurActuel];
            const indexAleatoire = Math.floor(Math.random() * joueur.main.length);
            jouerCarte(indexAleatoire);
        }

        function afficherJoueurs() {
            const conteneur = document.getElementById("joueurs");
            conteneur.innerHTML = "";
            joueurs.forEach((joueur, index) => {
                const div = document.createElement("div");
                div.className = "joueur";
                div.innerHTML = `<h3>${joueur.nom}</h3>`;
                const mainDiv = document.createElement("div");
                mainDiv.className = "cartes";
                joueur.main.forEach((carte, idx) => {
                    const carteDiv = document.createElement("div");
                    carteDiv.className = "carte";
                    carteDiv.textContent = carte.valeur + carte.couleur;
                    if (index === joueurActuel && index < 2) {
                        carteDiv.onclick = () => jouerCarte(idx);
                    } else {
                        carteDiv.classList.add("disabled");
                    }
                    mainDiv.appendChild(carteDiv);
                });
                div.appendChild(mainDiv);
                conteneur.appendChild(div);
            });
        }

        function afficherPli() {
            const pliZone = document.getElementById("pliZone");
            pliZone.innerHTML = "";
            pli.forEach(p => {
                const div = document.createElement("div");
                div.className = "carte";
                div.textContent = `${p.carte.valeur}${p.carte.couleur} (${p.joueur})`;
                pliZone.appendChild(div);
            });
        }

        function detecterGagnantPli() {
            const couleurDemandee = pli[0].carte.couleur;
            let meilleur = null;
            let indexMeilleur = -1;
            pli.forEach((p, index) => {
                if (p.carte.couleur === couleurDemandee) {
                    const force = ordreValeurs.indexOf(p.carte.valeur);
                    if (!meilleur || force > meilleur.force) {
                        meilleur = {joueur: p.joueur, force: force};
                        indexMeilleur = index;
                    }
                }
            });
            document.getElementById("resultatPli").textContent = `üèÜ ${meilleur.joueur} remporte le pli !`;
            pli = [];
            document.getElementById("pliZone").innerHTML = "";
            joueurActuel = indexMeilleur;
            afficherJoueurs();
            mettreAJourTour();
            if (joueurActuel >= 2) setTimeout(robotJoue, 1000);
        }

        function mettreAJourTour() {
            const tourTxt = document.getElementById("tourInfo");
            tourTxt.textContent = `C'est le tour de : ${joueurs[joueurActuel].nom}`;
        }
    </script>
</body>
</html>
